<DOCUMENT filename="index.html">

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="Chawp - Sleek Food Delivery">
    <meta name="author" content="VON">
    <meta name="theme-color" content="#1c1c1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="img/icon-192x192.png">
    <link rel="apple-touch-icon" href="img/icon-192x192.png">
    <title>Chawp Vendor Portal</title>
    <script>
  const url = new URL(window.location.href);
  if (!url.searchParams.has('refresh')) {
    url.searchParams.set('refresh', Date.now());
    window.location.replace(url.toString());
  }
</script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/styles.css">
  <!-- OneSignal Script -->
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>

<script>
  window.OneSignal = window.OneSignal || [];
  OneSignal.push(function () {
    OneSignal.init({
      appId: "bd22b221-3f13-4105-977e-330f65419187",
    safari_web_id: "web.onesignal.auto.512e7622-1d45-4df4-947f-a5316fda3b8e",
      serviceWorkerPath: "OneSignalSDKWorker.js",
      serviceWorkerUpdaterPath: "OneSignalSDKUpdaterWorker.js",
      notifyButton: { enable: false },
      allowLocalhostAsSecureOrigin: true
    });

    OneSignal.on('notificationDisplay', function (event) {
      console.log('ðŸ”” Notification shown:', event);
    });

    OneSignal.on('notificationClick', function (event) {
      toggleSection("view-orders");
      loadOrders();
    });

    // Ask for permission
    OneSignal.showNativePrompt();
  });
</script>


</head>
<body>
    <!-- Loading screen -->
    <div id="loading-screen">
        <h1 style="font-size: 2.5rem; font-weight: 600; letter-spacing: -1px; background: linear-gradient(45deg, #007aff, #34c759, #007aff); -webkit-background-clip: text; background-clip: text; color: transparent;">CHAWP</h1>
    </div>

    <!-- Login section -->
    <div id="login-section" class="section" style="display: none;">
        <div class="login-container">
            <h1 class="login-title">Welcome Back</h1>
            <p class="text-center text-gray-400 mb-4">Sign in to manage your restaurant</p>
            <div id="login-notification" class="notification" style="
                position: relative;
                transform: none;
                left: auto;
                top: auto;
                width: 100%;
                margin: 0 auto 1rem;
                animation: none;
            "></div>
            <form id="login-form" novalidate>
                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" class="form-input" placeholder="Enter your email" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <div class="password-container">
                        <input type="password" id="password" class="form-input" placeholder="Enter your password" autocomplete="current-password" minlength="6" required>
                        <button type="button" class="password-toggle" id="toggle-password" aria-label="Toggle password visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit" id="login-btn" class="login-btn">
  <div class="spinner" id="login-spinner" style="display: none;"></div>
  <span id="login-btn-text">Sign In</span>
</button>

            </form>
            <p class="text-center text-gray-400 mt-4 text-sm">Need help? <a href="https://wa.me/233593117766" class="text-blue-400">Contact support</a></p>
        </div>
    </div>

    <div id="main-content" class="container hidden">
        <h1 class="text-3xl font-semibold text-center mb-2"><span id="restaurant-name">Vendor Portal</span></h1>
        <p id="welcome-message" class="text-center text-gray-400 mb-6">Manage your culinary empire with elegance.</p>

        <div id="notification" class="notification"></div>

        <div id="store" class="section hidden">
            <p class="text-center mb-4">Control your shop's status below.</p>
            <div class="flex flex-col gap-2">
                <button id="open-shop-btn" class="btn btn-edit">Open Shop</button>
                <button id="close-shop-btn" class="btn btn-secondary">Close Shop</button>
            </div>
            <p id="shop-status" class="text-center mt-4">Shop Status: <span id="status-text" class="font-semibold">Closed</span></p>
            <div class="mt-6">
                <h2 class="text-xl font-semibold mb-3">Today's Dashboard</h2>
                <div class="dashboard-grid" id="dashboard-grid"></div>
            </div>
        </div>

        <div id="manage-menu" class="section hidden">
            <h2 class="text-xl font-semibold mb-3">Menu Management</h2>
            <p class="text-center mb-4">Add or update your dishes with ease.</p>
            <button id="add-dish-btn" class="btn">Add New Dish</button>
            <button id="view-categories-btn" class="btn">View Categories</button>

            <div id="menu-list" class="menu-list"></div>
        </div>

        <div id="categories-section" class="menu-edit-section hidden">
  <div class="menu-edit-container">
    <div class="menu-edit-header">
      <h3>Categories</h3>
      <button class="menu-edit-close-btn" id="close-categories-btn" aria-label="Close categories">Ã—</button>
    </div>
    <div id="category-list" class="menu-list"></div>
    <button id="add-category-btn-2" class="btn btn-add">+ Add New Category</button>
  </div>
</div>


        <div id="menu-edit-section" class="menu-edit-section hidden">
            <div class="menu-edit-container">
                <div class="menu-edit-header">
                    <h3 id="menu-edit-title">Add Dish</h3>
                    <p class="menu-edit-instructions">Enter the dish details below to add it to your menu.</p>
                    <button class="menu-edit-close-btn" id="menu-edit-close-btn" aria-label="Close section">Ã—</button>
                </div>
                <form id="menu-form" novalidate>
                    <div class="form-group">
                        <label for="menu-name" class="form-label">Dish Name</label>
                        <input type="text" id="menu-name" class="input" placeholder="e.g., Chicken Jollof" required aria-describedby="menu-name-error">
                        <span id="menu-name-error" class="error-message"></span>
                    </div>
                    <div class="form-group">
  <label for="menu-category" class="form-label">Category</label>
  <select id="menu-category" class="input">
    <option value="">-- Select Category --</option>
  </select>
  <button type="button" id="add-category-btn" class="btn btn-add" style="margin-top: 0.75rem;">+ Add New Category</button>
</div>

                    <div class="form-group">
                        <label for="menu-price" class="form-label">Base Price (GHâ‚µ)</label>
                        <input type="number" id="menu-price" class="input" placeholder="e.g., 25.00" step="0.01" min="0" required aria-describedby="menu-price-error">
                        <span id="menu-price-error" class="error-message"></span>
                    </div>
                    <div class="form-group">
  <label for="menu-order-number" class="form-label">Display Order Number</label>
  <input type="number" id="menu-order-number" class="input" placeholder="e.g., 1" min="0">
</div>

                    <div class="option-group" id="sizes-group">
                        <button type="button" class="toggle-btn" aria-expanded="false" aria-controls="size-list">Sizes <i class="fas fa-chevron-down"></i></button>
                        <div id="size-list" class="option-list hidden"></div>
                        <button type="button" id="add-size-btn" class="btn btn-add"><i class="fas fa-plus"></i> Add Size</button>
                    </div>
                    <div class="option-group" id="extras-group">
                        <button type="button" class="toggle-btn" aria-expanded="false" aria-controls="extra-list">Extras <i class="fas fa-chevron-down"></i></button>
                        <div id="extra-list" class="option-list hidden"></div>
                        <button type="button" id="add-extra-btn" class="btn btn-add"><i class="fas fa-plus"></i> Add Extra</button>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" id="save-dish-btn" class="btn btn-save">Save</button>
                        <button type="button" id="cancel-dish-btn" class="btn btn-cancel">Cancel</button>
                        <button type="button" id="undo-btn" class="btn btn-undo hidden">Undo</button>
                    </div>
                </form>
                <div id="help-overlay" class="help-overlay hidden">
                    <h4>How to Add a Dish</h4>
                    <p>Enter the dish name, like "Jollof Rice".</p>
                    <p>Add the base price in GHâ‚µ, such as 25.00.</p>
                    <p>Use "Add Size" or "Add Extra" to include options like "Large" or "Extra Cheese".</p>
                    <p>Tap "Save" to finish, or "Cancel" to start over.</p>
                    <p>Need more help? <a href="https://wa.me/233509330098" class="text-blue-400">Contact support</a>.</p>
                    <button class="btn btn-close-help" id="btn-close-help">Close</button>
                </div>
            </div>
        </div>

        <div id="view-orders" class="section">
            <h2 class="text-xl font-semibold mb-3"><u>Active Orders</u></h2>
            <div id="orders-list">Loading orders...</div>
        </div>

        <div id="delivered" class="section hidden">
            <h2 class="text-xl font-semibold mb-3">Delivery Status</h2>
            <div id="delivered-list">Loading delivery status...</div>
        </div>

        <div id="delivery" class="section hidden">
            <div class="section-header flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-white">Delivery Orders</h2>
                <button id="refresh-delivery-btn" class="btn text-sm bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div id="delivery-list" class="orders-list">Loading delivery orders...</div>
        </div>

        <div id="settings" class="section hidden">
            <h2 class="text-xl font-semibold mb-3">Settings</h2>
            <h3 class="text-lg font-semibold mb-2">Manage Store</h3>
            <form id="store-form" class="mb-4">
                <input type="text" id="store-name" placeholder="Store Name" class="input">
                <button type="submit" class="btn">Update Store</button>
            </form>
            <button id="refresh-app-btn" class="btn" style="background: #5856d6; margin-top: 0.5rem;">Refresh App</button>
           <br><br>
            <button id="logout-btn" class="btn btn-secondary mt-2">Logout</button>
        </div>

        <div class="footer-nav">
            <button id="view-orders-btn">
                <span class="relative inline-block">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="order-count" class="absolute -top-2 -right-3 text-[10px] bg-red-500 text-white rounded-full px-1.5 py-0.5 leading-none">0</span>
                </span>
                <span>Orders</span>
            </button>
             <button id="delivery-btn">
                <i class="fas fa-truck"></i>
                <span>Delivery</span>
            </button>
            <button id="delivered-btn"><i class="fas fa-history"></i><span>History</span></button>
           
            <button id="settings-btn"><i class="fas fa-cog"></i><span>Settings</span></button>
        </div>
    </div>

    <script type="module" src="script.js"></script>

    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                // Register custom service worker
                navigator.serviceWorker.register("/sw.js").then(registration => {
                    console.log("Custom ServiceWorker registration successful");
                    registration.update();
                }).catch(err => {
                    console.log("Custom ServiceWorker registration failed: ", err);
                });
            });
        }
    </script>


</body>
</html>

</DOCUMENT>